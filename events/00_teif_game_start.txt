namespace = game_start

### Hidden Game Start Event
event = {
	id = game_start.1
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = game_started

		every_country = {
			limit = { is_ai = no }
			country_event = { id = country.900 days = 460 random = 60 }
		}

		### SPAWN INVISIBLE GLOBAL EVENT COUNTRY
		create_country = {
			name = "global_event_country"
			type = global_event
			effect = {
				save_global_event_target_as = global_event_country
			}
		}

		### SPAWN SPECIAL COUNTRIES
		create_country = {
			name = "NAME_The_Shroud"
			type = shroud
			flag = {
				icon = {
					category = "special"
					file = "the_shroud.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"red"
					"black"
					"null"
					"null"
				}
			}
		}
		
		### HANDLE EMPIRE RELATIONS
		every_country = {
			limit = {
				has_country_flag = fallen_empire_machine
			}
			every_country = {
				limit = {
					is_country_type = drone
				}
				set_faction_hostility = {
					target = prev
					set_hostile = no
					set_neutral = no
					set_friendly = yes
				}					
			}
		}
		
		every_country = {
			limit = {
				is_country_type = tiyanki
			}
			every_country = {
				limit = {
					OR = {
						is_country_type = amoeba
						is_country_type = crystal
						is_country_type = cloud
					}				
				}
				set_faction_hostility = {
					target = prev
					set_hostile = no
					set_neutral = yes
					set_friendly = no
				}					
			}
		}	

		### MARAUDER FLAGS
		every_country = {
			limit = { is_country_type = dormant_marauders }
			randomize_flag_symbol = "pirate"
		}

		### MARAUDERS SHOULD NOT ATTACK ENCLAVES
		every_country = {
			limit = { is_country_type = enclave }
			every_country = {
				limit = { is_country_type = dormant_marauders }
				set_faction_hostility = {
					target = prev
					set_hostile = no
					set_neutral = no
					set_friendly = yes
				}
			}
		}		
	}
}

# Game start - Fallen Empires
country_event = {
	id = game_start.10
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = fallen_empire
	}

	immediate = {
		if = {
			limit = { is_ai = yes }
			switch = {
				trigger = has_ethic
				ethic_gestalt_consciousness = {
					create_ship_design = { design = "NAME_Omega" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Alpha" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Beta" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Gamma" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Sigma" }
					add_ship_design = last_created_design
					give_technology = { message = no tech = tech_pk_neutron }
				}
				ethic_fanatic_materialist = { 
					create_ship_design = { design = "NAME_Enforcer" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Savant" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Scholar" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Sage" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Cloaker" }
					add_ship_design = last_created_design
					give_technology = { message = no tech = tech_pk_shielder }
				}
				ethic_fanatic_spiritualist = { 
					create_ship_design = { design = "NAME_Cleanser" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Eternal" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Avatar" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Zealot" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Faith" }
					add_ship_design = last_created_design
					give_technology = { message = no tech = tech_pk_neutron }
				}
				ethic_fanatic_xenophile = { 
					create_ship_design = { design = "NAME_Adjuster" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Keeper" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Custodian" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Warden" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Watcher" }
					add_ship_design = last_created_design
					give_technology = { message = no tech = tech_pk_shielder }
				}
				ethic_fanatic_xenophobe = { 
					create_ship_design = { design = "NAME_Reaper" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Imperium" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Supremacy" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Glory" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Devastator" }
					add_ship_design = last_created_design
					give_technology = { message = no tech = tech_pk_cracker }
				}
				ethic_fanatic_authoritarian = { 
					create_ship_design = { design = "NAME_Giant" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Stellar" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Planedo" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Moon" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Dwarf" }
					add_ship_design = last_created_design
					give_technology = { message = no tech = tech_pk_cracker }
				}
				ethic_fanatic_egalitarian = { 
					create_ship_design = { design = "NAME_Harmony" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Liberty" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Freedom" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Equality" }
					add_ship_design = last_created_design
					create_ship_design = { design = "NAME_Bright" }
					add_ship_design = last_created_design
					give_technology = { message = no tech = tech_pk_shielder }
				}
			}
		}
		if = {
			limit = { is_materialist = yes }
			modify_species = {
				species = this
				add_trait = trait_cybernetic
			}	
		}
		if = {
			limit = { is_spiritualist = yes }
			modify_species = {
				species = this
				add_trait = trait_psionic
			}	
		}		
		if = {
			limit = {
				has_authority = auth_machine_intelligence
			}
			random_list = {
				66 = { set_country_flag = fallen_machine_empire_awaken_1 }	# Custodian
				33 = { set_country_flag = fallen_machine_empire_awaken_2 }	# Berserker
			}				
		}
		if = {
			limit = {
				NOT = { has_authority = auth_machine_intelligence }
			}
			every_owned_pop = {
				set_pop_flag = organic_fallen_empire_pop
			}
		}
		# contact other fallen empires & marauders
		every_country = {
			limit = { 
				OR = {
					is_country_type = faction
					is_country_type = adversary
					is_country_type = neutral_faction
					is_country_type = nomad
					is_country_type = pirate
					is_country_type = dormant_marauders
					is_country_type = ruined_marauders
					is_country_type = awakened_marauders
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
					is_country_type = rebel
					is_country_type = ambient
					is_country_type = enclave
					is_country_type = shroud_spirits
					is_country_type = tiyanki
					is_country_type = amoeba
					is_country_type = crystal
					is_country_type = drone
					is_country_type = cloud
					is_country_type = portal_holder
					is_country_type = feral_prethoryn
					is_country_type = feral_prethoryn_infighting
					is_country_type = marauder_raiders
					is_country_type = vol
					is_country_type = ratlings
					is_country_type = nivlacs
					is_country_type = enigmatic_cache
					is_country_type = gray_goo
					is_country_type = guardian
					is_country_type = guardian_dragon
					is_country_type = guardian_stellarite
					is_country_type = guardian_wraith
					is_country_type = guardian_hiver
					is_country_type = guardian_horror
					is_country_type = guardian_fortress
					is_country_type = guardian_dreadnought
					is_country_type = guardian_sphere
					is_country_type = guardian_scavenger_bot
					is_country_type = guardian_elderly_tiyanki
					is_country_type = ldragon_country
					is_country_type = guardian_hatchling
					is_country_type = prikki
				}			
				NOT = { has_communications = root }
			}
			establish_communications_no_message = root
		}		
		
		# setup mining & research stations			
		every_planet_within_border = {
			limit = { 
				has_deposit_for = shipclass_mining_station 
				has_mining_station = no
			}
			create_mining_station = {
				owner = ROOT
			}
		}
		every_planet_within_border = {
			limit = { 
				has_deposit_for = shipclass_research_station 
				has_research_station = no
			}
			create_research_station = {
				owner = ROOT
			}
		}
	}
}