namespace = fallenhuman
country_event = {
	id = fallenhuman.0
	title = ""
	desc = ""	
	hide_window = yes
	fire_only_once = yes
	trigger = {
		has_country_flag = fallen_empire_6
		NOT = { has_country_flag = changespecies }
	}
	immediate = {
		every_country = {
			limit = {
				has_country_flag = fallen_empire_6
			}
			event_target:sanctuary = {
				set_faction_hostility = {
					target = prev
					set_hostile = no
					set_neutral = no
					set_friendly = yes
				}					
			}
			#create_ambient_object = {
			#	type = planet_shield
			#	scale = 0.13
			#	location = event_target:star_pressure_controller
			#	use_3d_location = yes
			#	entity_face_object = star
			#	entity_scale_to_size = yes
			#	target = event_target:star_pressure_controller
			#}
		}
		random_planet = {
			limit = {
				has_planet_flag = planet_earth_fallen
			}
			if = {
				limit = { NOT = { is_planet_class =  pc_continental } }
				change_pc = pc_continental
			}
			save_event_target_as = pef
		}
		create_species = {
			name = "PRESCRIPTED_species_name_humans1"
			plural="PRESCRIPTED_species_plural_humans1"
			class = HUM
			portrait = human
			homeworld = event_target:pef
			traits = {
				trait = "trait_adaptive"
				trait = "trait_nomadic"
				trait = "trait_wasteful"
			}
			effect = { save_global_event_target_as = fallen_human_pop }
		}
		event_target:fallen_human_pop = {
			create_species = {
				is_mod = yes
				name = this
				plural = this
				class = this
				portrait = this
				homeworld = event_target:pef
				traits = {
					trait = "trait_fertile"
					trait = "trait_erudite"
					trait = "trait_robust"
					trait = "trait_charismatic"
					trait = "trait_communal"
					trait = "trait_rapid_breeders"
					trait = "trait_extremely_adaptive"
					trait = "trait_cybernetic"
				}
				effect = { save_global_event_target_as = fallen_human_pop_species }
			}
		}
		random_country = {
			limit = {
				is_country_type = fallen_empire
				has_ethic = ethic_fanatic_egalitarian
				has_country_flag = fallen_empire_6
			}
			save_event_target_as = fallen_human
		}
		every_owned_pop = {
			limit = { is_robot_pop = no }
			change_species = event_target:fallen_human_pop_species
		}
		every_owned_pop = {
			limit = { is_robot_pop = yes }
			modify_species = {
				species = this
				add_trait = trait_robot_power_drills
			}
			modify_species = {
				species = this
				add_trait = trait_robot_efficient_processors
			}
			modify_species = {
				species = this
				add_trait = trait_robot_mass_produced
			}
		}
		every_owned_army = {
			limit = {
				exists = species
				exists = planet
			}
			modify_army = {
				type = "defense_army"
				species = event_target:fallen_human_pop_species
			}
		}
		every_owned_leader = {
			limit = { is_same_species = root }
			change_species = event_target:fallen_human_pop_species
		}
		every_pool_leader = {
			limit = { is_same_species = root }
			change_species = event_target:fallen_human_pop_species
		}
		change_dominant_species = { species = event_target:fallen_human_pop_species }
		create_leader = {
			type = ruler
			name = "谢尔盖·狄马尼斯"
			species = owner_species
			set_age = 20
		}
		last_created_leader = {
			set_is_female = no
		}
		set_leader = last_created_leader
		every_owned_leader = {
			limit = { leader_class = ruler }
			add_trait = trait_ruler_champion_of_the_people
			add_trait = trait_ruler_industrialist
			add_trait = trait_ruler_space_miner
		}
		random_planet = {
			limit = {
				has_planet_flag = planet_earth_fallen
			}
			change_pc = { class = pc_shielded_gaia inherit_entity = yes }
			set_planet_entity = { entity = continental_planet_earth_entity }
		}
		every_owned_planet = {
			limit = { planet_size < 25 }
			set_planet_size = 25
			change_pc = pc_gaia
		}
		country_event = { id = fallenhuman.1 }
	}
}

country_event = {
	id = fallenhuman.1
	title = ""
	desc = ""	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			limit = {
				is_country_type = fallen_empire
				species_portrait = human
				NOT = { has_country_flag = fallenhuman }
				is_ai = yes
				OR = {
					has_country_flag = fallen_empire_1
					has_country_flag = fallen_empire_2
					has_country_flag = fallen_empire_3
					has_country_flag = fallen_empire_4
					has_country_flag = fallen_empire_5
				}
			}
			set_country_flag = fallenhuman
			every_owned_pop = {
				limit = { species_portrait = human }
				change_species = event_target:fallen_human_pop_species
			}
			every_owned_leader = {
				change_species = event_target:fallen_human_pop_species
			}
			every_pool_leader = {
				change_species = event_target:fallen_human_pop_species
			}
			change_dominant_species = { species = event_target:fallen_human_pop_species }
		}
		every_country = {
			limit = {
				OR = {
					is_country_type = default
					is_country_type = primitive
				}
				NOT = {
					has_authority = auth_machine_intelligence
					has_country_flag = fallenhuman
					has_valid_civic = civic_syncretic_evolution
					
				}
				any_owned_pop = {
					NOR = { 
						has_trait = trait_robotic_3
						has_trait = trait_psionic
					}
					species_portrait = human
				}
			}
			country_event = { id = fallenhuman.2 }
		}
		every_country = {
			limit = {
				is_country_type = default
				NOT = { has_country_flag = fallenhuman }
				OR = {
					has_valid_civic = civic_syncretic_evolution
					has_authority = auth_machine_intelligence
				}
				any_owned_pop = {
					species_portrait = human
				}
			}
			country_event = { id = fallenhuman.3 }
		}
	}
}

country_event = {
	id = fallenhuman.2
	title = "fallenhuman.2.name"
	desc = "fallenhuman.2.desc"
	is_triggered_only = yes
	hide_window = no
	picture = GFX_evt_medieval_alien_civilization
	show_sound = event_primitive_civilization
	immediate = {
		owner_species = { save_event_target_as = playerhuman }
	}
	option = {
		name = "fallenhuman.is_newhuman"
		trigger = { NOT = { has_authority = auth_machine_intelligence } }
		hidden_effect = {
			create_species = {
				name = this
				namelist = this
				plural = this
				class = this
				portrait = this
				traits = this
				homeworld = event_target:fallen_human_pop
			}
			setup_species = yes
			every_owned_army = {
				limit = {
					exists = species
					exists = planet
				}
				modify_army = {
					type = "defense_army"
					species = last_created_species
				}
			}
			every_owned_leader = {
				change_species = last_created_species
			}
			every_pool_leader = {
				change_species = last_created_species
			}
			modify_species = {
				species = this
				base = event_target:fallen_human_pop
			}
		}
	}
	option = {
		name = "fallenhuman.is_human"
		trigger = { NOT = { has_authority = auth_machine_intelligence } }
		hidden_effect = {
			create_species = {
				name = "PRESCRIPTED_species_name_humans1"
				namelist = this
				plural = "PRESCRIPTED_species_plural_humans1"
				class = HUM
				portrait = human
				traits = this
				homeworld = event_target:fallen_human_pop
			}
			setup_species = yes
			every_owned_army = {
				limit = {
					exists = species
					exists = planet
				}
				modify_army = {
					type = "defense_army"
					species = last_created_species
				}
			}
			every_owned_leader = {
				change_species = last_created_species
			}
			every_pool_leader = {
				change_species = last_created_species
			}
			modify_species = {
				species = this
				base = event_target:fallen_human_pop
			}
		}
	}
	option = {
		name = "fallenhuman.what_is_human"
		ai_chance = {
			factor = 0
		}
	}
}

country_event = {
	id = fallenhuman.3
	title = "fallenhuman.3.name"
	desc = "fallenhuman.3.desc"
	is_triggered_only = yes
	hide_window = no
	picture = GFX_evt_medieval_alien_civilization
	show_sound = event_primitive_civilization
	immediate = {
		random_owned_pop = {
			limit = { NOT = { is_same_species = root } }
			species = { save_event_target_as = playerhuman_machine }
		}
	}
	option = {
		name = "fallenhuman.is_newhuman"
		trigger = { OR = { has_authority = auth_machine_intelligence has_valid_civic = civic_syncretic_evolution } }
		hidden_effect = {
			event_target:playerhuman_machine = {
				create_species = {
					#is_mod = yes
					name = this
					namelist = this
					plural = this
					class = this
					portrait = this
					traits = this
					homeworld = event_target:fallen_human_pop
				}
			}
			modify_species = {
				#species = event_target:playerhuman_machine
				species = last_created_species
				base = event_target:fallen_human_pop
				change_scoped_species = no
			}
			setup_species_machine = yes
			every_owned_pop = {
				limit = { NOT = { is_same_species = root } }
				set_citizenship_type = { country = prev type = citizenship_full_machine cooldown = no }
			}
		}
	}
	option = {
		name = "fallenhuman.is_human"
		trigger = { OR = { has_authority = auth_machine_intelligence has_valid_civic = civic_syncretic_evolution } }
		hidden_effect = {
			random_owned_pop = {
				limit = { species_portrait = human }
				species = { save_event_target_as = playerhuman_machine_before }
			}
			
			modify_species = {
				species = event_target:playerhuman_machine
				base = event_target:fallen_human_pop
				change_scoped_species = no
			}
			event_target:playerhuman_machine = {
				create_species = {
					name = "PRESCRIPTED_species_name_humans1"
					namelist = this
					plural = "PRESCRIPTED_species_plural_humans1"
					class = HUM
					portrait = human
					traits = this
					homeworld = event_target:fallen_human_pop
					effect = { save_event_target_as = temp_species }
				}
			}
			modify_species = {
				species = event_target:temp_species
				base = event_target:fallen_human_pop
				change_scoped_species = no
			}
			setup_species_machine = yes
			every_owned_pop = {
				limit = { NOT = { is_same_species = root } }
				set_citizenship_type = { country = prev type = citizenship_full_machine cooldown = no }
			}
		}
	}
	option = {
		name = "fallenhuman.what_is_human"
		ai_chance = {
			factor = 0
		}
	}
}

country_event = {
	id = fallenhuman.4
	is_triggered_only = yes
	fire_only_once = yes
	hide_window = yes
	trigger = {
		any_country = {
			any_owned_pop = { species_portrait = human }
		}
	}
	immediate = {
		if = {
			limit = { NOT = { exists = event_target:fallen_empire_6 } }
			create_species = {
				name = "PRESCRIPTED_species_name_humans1"
				namelist = this
				plural = "PRESCRIPTED_species_plural_humans1"
				class = HUM
				portrait = human
				traits = this
				effect = { save_global_event_target_as = no_unoe_human_species }
			}
			every_country = {
				limit = {
					OR = { is_country_type = primitive is_country_type = default is_country_type = fallen_empire }
					NOR = { has_authority = auth_machine_intelligence has_valid_civic = civic_syncretic_evolution }
					is_ai = yes
					species_portrait = human
				}
				every_owned_pop = { change_species = event_target:no_unoe_human_species }
				change_dominant_species = { species = event_target:no_unoe_human_species }
				every_owned_leader = {
					change_species = event_target:no_unoe_human_species
				}
				every_pool_leader = {
					change_species = event_target:no_unoe_human_species
				}
			}
			every_country = {
				limit = {
					OR = { is_country_type = primitive is_country_type = default is_country_type = fallen_empire }
					OR = { has_authority = auth_machine_intelligence has_valid_civic = civic_syncretic_evolution }
					is_ai = yes
					any_owned_pop = { species_portrait = human }
				}
				every_owned_pop = { limit = { species_portrait = human } change_species = event_target:no_unoe_human_species }
			}
		}
	}
}