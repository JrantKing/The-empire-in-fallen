namespace = fallen_start

event = {
	id = fallen_start.0
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		any_country = {
			is_country_type = default
			has_government = gov_teif_stagnant_ascendancy
		}
	}
	immediate = {
		if = {
			limit = { is_multiplayer = yes }
			every_country = {
				limit = { is_ai = no }
				country_event = { id = fallen_start.4 }
			}
		}
		else = {
			every_country = {
				if = {
					limit = {
						is_country_type = default
						has_government = gov_teif_stagnant_ascendancy
						NOR = {
							graphical_culture = fallen_empire_01
							graphical_culture = fallen_empire_02
							graphical_culture = fallen_empire_03
							graphical_culture = fallen_empire_04
							graphical_culture = fallen_empire_05
							graphical_culture = fallen_empire_06
							graphical_culture = fallen_empire_07
							graphical_culture = fallen_empire_08
							graphical_culture = fallen_empire_09
							graphical_culture = fallen_empire_10
							graphical_culture = fallen_empire_11
							graphical_culture = fallen_empire_12
							graphical_culture = fallen_machine_empire_01
							graphical_culture = fallen_machine_empire_02
						}
					}
					country_event = { id = techfound.29 }
				}
				else = {
					if = {
						limit = {
							is_country_type = default
							has_government = gov_teif_stagnant_ascendancy
							OR = {
								graphical_culture = fallen_empire_01
								graphical_culture = fallen_empire_02
								graphical_culture = fallen_empire_03
								graphical_culture = fallen_empire_04
								graphical_culture = fallen_empire_05
								graphical_culture = fallen_empire_06
								graphical_culture = fallen_empire_07
								graphical_culture = fallen_empire_08
								graphical_culture = fallen_empire_09
								graphical_culture = fallen_empire_10
								graphical_culture = fallen_empire_11
								graphical_culture = fallen_empire_12
								graphical_culture = fallen_machine_empire_01
								graphical_culture = fallen_machine_empire_02
							}
						}
						country_event = { id = fallen_start.1 }
					}
				}
			}
		}
	}
}

country_event = {
	id = fallen_start.1
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		in_fallen = yes
		if = {
			limit = {
				has_country_flag = no_fallen_graphical_culture
				has_country_flag = being_fallen
			}
			root = { save_event_target_as = sender }
			every_country = {
				limit = {
					OR = {
						is_country_type = default
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
					has_communications = root
				}
				country_event = { id = techfound.5 }
			}
		}
	}
}

country_event = {
	id = fallen_start.2
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		spawn_start_navy = yes
	}
}

event = {
	id = fallen_start.3
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		every_playable_country = {
			limit = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}
			every_country = {
				limit = {
					OR = {
						is_country_type = faction
						is_country_type = adversary
						is_country_type = neutral_faction
						is_country_type = nomad
						is_country_type = pirate
						is_country_type = dormant_marauders
						is_country_type = ruined_marauders
						is_country_type = awakened_marauders
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
						is_country_type = rebel
						is_country_type = ambient
						is_country_type = enclave
						is_country_type = shroud_spirits
						is_country_type = tiyanki
						is_country_type = amoeba
						is_country_type = crystal
						is_country_type = drone
						is_country_type = cloud
						is_country_type = portal_holder
						is_country_type = feral_prethoryn
						is_country_type = feral_prethoryn_infighting
						is_country_type = marauder_raiders
						is_country_type = vol
						is_country_type = ratlings
						is_country_type = nivlacs
						is_country_type = enigmatic_cache
						is_country_type = gray_goo
						is_country_type = guardian
						is_country_type = guardian_dragon
						is_country_type = guardian_stellarite
						is_country_type = guardian_wraith
						is_country_type = guardian_hiver
						is_country_type = guardian_horror
						is_country_type = guardian_fortress
						is_country_type = guardian_dreadnought
						is_country_type = guardian_sphere
						is_country_type = guardian_scavenger_bot
						is_country_type = guardian_elderly_tiyanki
						is_country_type = ldragon_country
						is_country_type = guardian_hatchling
						is_country_type = prikki
						is_country_type = caravaneer_home
						is_country_type = caravaneer_fleet
					}
					NOT = { has_communications = prev }
				}
				establish_communications_no_message = prev
			}
		}
	}
}

country_event = {
	id = fallen_start.4
	title = "fallen_start.4.name"
	desc = "fallen_start.4.desc"
	picture = GFX_evt_ancient_alien_temple
	show_sound = event_alien_signal
	is_triggered_only = yes
	immediate = {
		set_country_flag = voting
		random_country = {
			limit = {
				is_country_type = global_event
			}
			save_event_target_as = global_event
		}
	}
	option = {
		name = "fallen_start.4.a"
		hidden_effect = {
			event_target:global_event = {
				change_variable = { which = num_allow_fallen_player = value = 1 }
			}
			set_country_flag = voted
		}
	}
	option = {
		name = "fallen_start.4.b"
		hidden_effect = {
			event_target:global_event = {
				change_variable = { which = num_not_allow_fallen_player = value = 1 }
			}
			set_country_flag = voted
		}
	}
	after ={
		if = {
			limit = {
				count_country = {
					count = all
					is_ai = no
					has_country_flag = voting
					has_country_flag = voted
				}
			}
			event_target:global_event = {
				subtract_variable = { which = num_allow_fallen_player value = num_not_allow_fallen_player }
			}
			if = {
				limit = {
					event_target:global_event = {
						check_variable = { which = num_allow_fallen_player value >= 0 }
					}
				}
				every_country = {
					if = {
						limit = {
							is_country_type = default
							has_government = gov_teif_stagnant_ascendancy
							NOR = {
								graphical_culture = fallen_empire_01
								graphical_culture = fallen_empire_02
								graphical_culture = fallen_empire_03
								graphical_culture = fallen_empire_04
								graphical_culture = fallen_empire_05
								graphical_culture = fallen_empire_06
								graphical_culture = fallen_empire_07
								graphical_culture = fallen_empire_08
								graphical_culture = fallen_empire_09
								graphical_culture = fallen_empire_10
								graphical_culture = fallen_empire_11
								graphical_culture = fallen_empire_12
								graphical_culture = fallen_machine_empire_01
								graphical_culture = fallen_machine_empire_02
							}
						}
						country_event = { id = techfound.29 }
					}
					else = {
						if = {
							limit = {
								is_country_type = default
								has_government = gov_teif_stagnant_ascendancy
								OR = {
									graphical_culture = fallen_empire_01
									graphical_culture = fallen_empire_02
									graphical_culture = fallen_empire_03
									graphical_culture = fallen_empire_04
									graphical_culture = fallen_empire_05
									graphical_culture = fallen_empire_06
									graphical_culture = fallen_empire_07
									graphical_culture = fallen_empire_08
									graphical_culture = fallen_empire_09
									graphical_culture = fallen_empire_10
									graphical_culture = fallen_empire_11
									graphical_culture = fallen_empire_12
									graphical_culture = fallen_machine_empire_01
									graphical_culture = fallen_machine_empire_02
								}
							}
							country_event = { id = fallen_start.1 }
						}
					}
				}
			}
		}
	}
}

event = {
	id = fallen_start.5
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		every_playable_country = {
			limit = { is_country_type = fallen_empire is_ai = yes }
			every_planet_within_border = {
				limit = {
					has_planet_flag = ideal_planet_class
				}
				remove_planet_flag = ideal_planet_class
			}
		}
	}
}